<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <title>Campaign ‚Äì Foodbank Logistics Hub</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- Leaflet (OpenStreetMap) -->
  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
    crossorigin=""
  />

  <style>
    /* ========= Reset & base ========= */
    *, *::before, *::after {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
        sans-serif;
      color: #111827;
      background: #f5f6fb;
    }

    .app {
      display: flex;
      min-height: 100vh;
    }

    /* ========= Sidebar ========= */

    .sidebar-main {
      width: 220px;
      background: #050816;
      color: #f9fafb;
      padding: 16px 16px 20px;
      display: flex;
      flex-direction: column;
      gap: 16px;
    }

    .sidebar-main-header {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .logo-circle {
      width: 34px;
      height: 34px;
      border-radius: 12px;
      background: linear-gradient(135deg, #facc15, #f97316);
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      color: #111827;
    }

    .logo-title {
      font-weight: 700;
      font-size: 1rem;
    }

    .logo-sub {
      font-size: 0.75rem;
      opacity: 0.7;
    }

    .sidebar-main-nav {
      display: flex;
      flex-direction: column;
      gap: 4px;
      margin-top: 10px;
      flex: 1;
    }

    .nav-item {
      border: none;
      outline: none;
      background: transparent;
      color: #e5e7eb;
      padding: 8px 10px;
      border-radius: 999px;
      text-align: left;
      font-size: 0.85rem;
      cursor: pointer;
      transition: background 0.15s, transform 0.08s;
    }

    .nav-item:hover {
      background: rgba(148, 163, 184, 0.35);
      transform: translateY(-1px);
    }

    .nav-item-active {
      background: #facc15;
      color: #111827;
    }

    .sidebar-main-user {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 10px 8px;
      border-radius: 12px;
      background: #020617;
    }

    .avatar-circle {
      width: 30px;
      height: 30px;
      border-radius: 999px;
      background: #0f172a;
      border: 2px solid #facc15;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.75rem;
    }

    .user-name {
      font-size: 0.85rem;
      font-weight: 600;
    }

    .user-role {
      font-size: 0.75rem;
      opacity: 0.7;
    }

    /* ========= Layout Campaign (c·ªôt 2 + 3) ========= */

    .campaign-layout {
      flex: 1;
      display: grid;
      grid-template-columns: 360px minmax(0, 1fr);
    }

    /* ========= Sidebar campaign (c·ªôt 2) ========= */

    .campaign-sidebar {
      background: #fdfdfd;
      border-right: 1px solid #e5e7eb;
      display: flex;
      flex-direction: column;
      height: 100vh;
    }

    .campaign-sidebar-header {
      padding: 18px 20px 10px;
      display: flex;
      justify-content: space-between;
      gap: 8px;
      align-items: center;
      border-bottom: 1px solid #e5e7eb;
    }

    .campaign-sidebar-header h1 {
      margin: 0;
      font-size: 1.05rem;
    }

    .campaign-sidebar-header p {
      margin: 2px 0 0;
      font-size: 0.8rem;
      color: #6b7280;
    }

    .campaign-sidebar-filters {
      padding: 10px 20px 8px;
      border-bottom: 1px solid #e5e7eb;
    }

    .search-wrapper {
      margin-bottom: 8px;
    }

    .input {
      width: 100%;
      border-radius: 999px;
      border: 1px solid #e5e7eb;
      padding: 7px 11px;
      font-size: 0.85rem;
    }

    .search-input {
      padding-left: 30px;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16'%3E%3Ccircle cx='7' cy='7' r='4.5' stroke='%239ca3af' stroke-width='1.4' fill='none'/%3E%3Cpath d='M10 10l3 3' stroke='%239ca3af' stroke-width='1.4' stroke-linecap='round'/%3E%3C/svg%3E");
      background-repeat: no-repeat;
      background-position: 9px center;
      background-size: 16px;
    }

    .chips-row {
      display: flex;
      gap: 6px;
      flex-wrap: wrap;
    }

    .chip {
      border-radius: 999px;
      border: 1px solid #e5e7eb;
      padding: 3px 10px;
      font-size: 0.75rem;
      background: #ffffff;
      cursor: pointer;
    }

    .chip-active {
      background: #facc15;
      border-color: #facc15;
    }

    .campaign-list {
      flex: 1;
      overflow-y: auto;
      padding: 10px 14px 16px;
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .campaign-card {
      background: #ffffff;
      border-radius: 14px;
      border: 1px solid #e5e7eb;
      box-shadow: 0 1px 3px rgba(15, 23, 42, 0.06);
      padding: 10px 12px;
      cursor: pointer;
      transition: box-shadow 0.15s, transform 0.08s, border-color 0.15s,
        background 0.15s;
    }

    .campaign-card:hover {
      box-shadow: 0 4px 10px rgba(15, 23, 42, 0.15);
      transform: translateY(-1px);
    }

    .campaign-card.active {
      border-color: #facc15;
      background: #fffbeb;
    }

    .campaign-card-inner {
      display: flex;
      gap: 10px;
    }

    .campaign-thumb-wrapper {
      flex-shrink: 0;
      display: flex;
      align-items: center;
    }

    .campaign-thumbnail {
      width: 64px;
      height: 64px;
      border-radius: 12px;
      object-fit: cover;
      background: #e5e7eb;
    }

    .campaign-info {
      flex: 1;
      display: flex;
      flex-direction: column;
    }

    .campaign-card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .campaign-id {
      font-weight: 600;
      font-size: 0.9rem;
    }

    .status-pill {
      padding: 3px 9px;
      border-radius: 999px;
      font-size: 0.7rem;
      font-weight: 600;
      white-space: nowrap;
    }

    .status-InTransit {
      background: #dbeafe;
      color: #1d4ed8;
    }

    .status-Delivered {
      background: #dcfce7;
      color: #15803d;
    }

    .status-Upcoming {
      background: #fef9c3;
      color: #854d0e;
    }

    .campaign-body {
      font-size: 0.78rem;
      color: #6b7280;
      margin-top: 5px;
    }

    .campaign-name {
      font-weight: 600;
      margin-bottom: 2px;
      font-size: 0.8rem;
    }

    .campaign-location {
      font-size: 0.7rem;
      color: #6b7280;
    }

    .campaign-progress {
      height: 6px;
      border-radius: 999px;
      background: #f3f4f6;
      overflow: hidden;
      margin: 6px 0 4px; 
    }

    .campaign-progress-bar {
      height: 100%;
      background: linear-gradient(90deg, #22c55e, #facc15);
    }

    .campaign-volunteers {
      font-size: 0.7rem;
      color: #4b5563;
    }

    /* ========= Campaign detail (c·ªôt 3) ========= */

    .campaign-detail {
      display: flex;
      flex-direction: column;
      height: 100vh;
    }

    .campaign-detail-header {
      padding: 16px 22px 12px;
      border-bottom: 1px solid #e5e7eb;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .campaign-detail-label {
      font-size: 0.78rem;
      color: #9ca3af;
    }

    .campaign-detail-title {
      font-size: 1.05rem;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .campaign-detail-actions {
      display: flex;
      gap: 8px;
    }

    .icon-btn {
      border-radius: 999px;
      border: 1px solid #e5e7eb;
      background: #ffffff;
      width: 32px;
      height: 32px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.9rem;
      cursor: pointer;
    }

    .icon-btn:hover {
      background: #f3f4f6;
    }

    .campaign-detail-body {
      flex: 1;
      display: grid;
      grid-template-columns: 320px minmax(0, 1fr);
      padding: 14px 22px 20px;
      gap: 16px;
    }

    .campaign-timeline {
      background: #ffffff;
      border-radius: 18px;
      box-shadow: 0 1px 3px rgba(15, 23, 42, 0.08);
      padding: 12px 14px 14px;
      display: flex;
      flex-direction: column;
    }

    .timeline-tabs {
      display: flex;
      gap: 4px;
      margin-bottom: 10px;
    }

    .tab {
      flex: 1;
      border-radius: 999px;
      border: 1px solid #e5e7eb;
      background: #f9fafb;
      padding: 5px 0;
      font-size: 0.8rem;
      cursor: pointer;
    }

    .tab-active {
      background: #111827;
      color: #f9fafb;
    }

    .timeline-list {
      list-style: none;
      margin: 5 0 10px;
      padding: 0;
    }

    .timeline-item {
      display: flex;
      gap: 15px;
      margin-bottom: 12px;
    }

    .timeline-dot {
      width: 10px;
      height: 10px;
      border-radius: 999px;
      background: #e5e7eb;
      margin-top: 4px;
    }

    .timeline-dot-primary {
      background: #1d4ed8;
    }

    .timeline-content {
      font-size: 0.8rem;
    }

    .timeline-title {
      font-weight: 600;
    }

    .timeline-text {
      color: #4b5563;
    }

    .campaign-meta {
      margin-top: 15px;
      font-size: 0.8rem;
      color: #4b5563;
    }

    .campaign-meta div span:first-child {
      color: #6b7280;
    }

    /* panels cho 2 tab */
    .timeline-tab-panel {
      display: none;
    }

    .timeline-tab-panel.active {
      display: block;
    }

    /* Danh s√°ch TNV */
    .vol-list-header {
      font-size: 0.8rem;
      font-weight: 600;
      margin-bottom: 6px;
    }

    .vol-list {
      max-height: 260px;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .vol-card {
      border-radius: 12px;
      border: 1px solid #e5e7eb;
      padding: 6px 10px;
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      font-size: 0.78rem;
      background: #f9fafb;
    }

    .vol-card-main {
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .vol-name {
      font-weight: 600;
    }

    .vol-code {
      color: #6b7280;
      font-size: 0.74rem;
    }

    .vol-card-side {
      text-align: right;
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .vol-pill {
      padding: 2px 8px;
      border-radius: 999px;
      background: #ecfeff;
      color: #0369a1;
      font-size: 0.72rem;
      font-weight: 500;
      align-self: flex-end;
    }

    .vol-phone {
      font-size: 0.74rem;
      color: #4b5563;
    }

    /* Map panel */

    .campaign-map-wrapper {
      background: #ffffff;
      border-radius: 18px;
      box-shadow: 0 1px 3px rgba(15, 23, 42, 0.08);
      padding: 10px 10px 10px;
      display: flex;
      flex-direction: column;
    }

    .map-toolbar {
      display: flex;
      gap: 8px;
      margin-bottom: 6px;
    }

    .map-btn {
      border-radius: 999px;
      border: 1px solid #e5e7eb;
      background: #f9fafb;
      padding: 4px 10px;
      font-size: 0.8rem;
    }

    .map-btn-active {
      background: #facc15;
      border-color: #facc15;
    }

    .map {
      flex: 1;
      min-height: 340px;
      border-radius: 16px;
      border: 1px solid #e5e7eb;
    }

    /* ======== Custom marker cho TNV tr√™n map ======== */

    .vol-marker-wrapper.leaflet-div-icon {
      background: transparent;
      border: none;
    }

    .vol-marker {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: 3px 8px;
      border-radius: 999px;
      background: #111827;
      color: #f9fafb;
      font-size: 11px;
      font-weight: 500;
      box-shadow: 0 2px 6px rgba(15, 23, 42, 0.45);
      border: 1px solid rgba(148, 163, 184, 0.5);
      white-space: nowrap;
    }

    /* Buttons */

    .btn {
      border-radius: 999px;
      border: 1px solid transparent;
      padding: 7px 13px;
      font-size: 0.8rem;
      cursor: pointer;
    }

    .btn-primary {
      background: #111827;
      color: #f9fafb;
    }

    .btn-primary:hover {
      opacity: 0.9;
    }

    @media (max-width: 1100px) {
      .campaign-layout {
        grid-template-columns: 1fr;
      }
      .sidebar-main {
        display: none;
      }
    }

    @media (max-width: 900px) {
      .campaign-detail-body {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body class="app">
  <!-- SIDEBAR -->
  <aside class="sidebar-main">
    <div class="sidebar-main-header">
      <div class="logo-circle">FB</div>
      <div>
        <div class="logo-title">Foodbank</div>
        <div class="logo-sub">Logistics Hub</div>
      </div>
    </div>

    <nav class="sidebar-main-nav">
      <button class="nav-item" onclick="goTo('orders.html')">ƒê∆°n h√†ng</button>
      <button class="nav-item" onclick="goTo('trip.html')">Trip / Tuy·∫øn ƒë∆∞·ªùng</button>
      <button class="nav-item nav-item-active" onclick="goTo('campaign.html')">Campaign</button>
      <button class="nav-item" onclick="goTo('volunteers.html')">T√¨nh nguy·ªán vi√™n</button>
      <button class="nav-item" onclick="goTo('community.html')">T·ªï d√¢n ph·ªë</button>
      <button class="nav-item" onclick="goTo('warehouse.html')">Kho t·∫≠p k·∫øt</button>
      <button class="nav-item">S·ª± c·ªë & h·ªó tr·ª£</button>
    </nav>

    <div class="sidebar-main-user">
      <div class="avatar-circle">AD</div>
      <div>
        <div class="user-name">Admin ‚Äì V√¢n</div>
        <div class="user-role">ƒêi·ªÅu ph·ªëi trung t√¢m</div>
      </div>
    </div>
  </aside>

  <!-- LAYOUT CAMPAIGN -->
  <main class="campaign-layout">
    <!-- C·ªòT 2: DANH S√ÅCH CAMPAIGN -->
    <section class="campaign-sidebar">
      <header class="campaign-sidebar-header">
        <div>
          <h1>Tracking campaigns</h1>
          <p>Theo d√µi c√°c chi·∫øn d·ªãch t√¨nh nguy·ªán</p>
        </div>
        <button class="btn btn-primary" id="btnAddCampaign">+ Add campaign (demo)</button>
      </header>

      <div class="campaign-sidebar-filters">
        <div class="search-wrapper">
          <input
            id="campaignSearch"
            class="input search-input"
            placeholder="T√¨m Campaign ID, t√™n chi·∫øn d·ªãch‚Ä¶"
          />
        </div>
        <div class="chips-row">
          <button class="chip chip-active" data-status="ALL">All</button>
          <button class="chip" data-status="InTransit">ƒêang ch·∫°y</button>
          <button class="chip" data-status="Upcoming">S·∫Øp di·ªÖn ra</button>
          <button class="chip" data-status="Delivered">Ho√†n th√†nh</button>
        </div>
      </div>

      <div id="campaignList" class="campaign-list">
        <!-- JS render danh s√°ch campaign -->
      </div>
    </section>

    <!-- C·ªòT 3: CHI TI·∫æT CAMPAIGN + MAP -->
    <section class="campaign-detail">
      <header class="campaign-detail-header">
        <div>
          <div class="campaign-detail-label">ƒêang theo d√µi</div>
          <div class="campaign-detail-title">
            Campaign <span id="detailCampaignId">‚Äì</span>
            <span id="detailCampaignStatus" class="status-pill">‚Äì</span>
          </div>
        </div>
        <div class="campaign-detail-actions">
          <button class="icon-btn" title="G·ªçi TNV">üìû</button>
          <button class="icon-btn" title="Chat">üí¨</button>
          <button class="icon-btn" title="Xem docs">üìÑ</button>
        </div>
      </header>

      <div class="campaign-detail-body">
        <!-- PANEL DETAIL + LIST TNV -->
        <div class="campaign-timeline">
          <div class="timeline-tabs">
            <button class="tab tab-active" data-tab="detail">Campaign detail</button>
            <button class="tab" data-tab="volunteers">Danh s√°ch TNV</button>
          </div>

          <!-- Tab: Campaign detail -->
          <div id="tabDetail" class="timeline-tab-panel active">
            <ul class="timeline-list">
              <!-- T√™n chi·∫øn d·ªãch -->
              <li class="timeline-item">
                <div class="timeline-dot timeline-dot-primary"></div>
                <div class="timeline-content">
                  <div class="timeline-title">T√™n chi·∫øn d·ªãch:</div>
                  <div id="detailCampaignName" class="timeline-text"></div>
                </div>
              </li>

              <!-- M√¥ t·∫£ -->
              <li class="timeline-item">
                <div class="timeline-dot"></div>
                <div class="timeline-content">
                  <div class="timeline-title">M√¥ t·∫£:</div>
                  <div id="detailCampaignDescription" class="timeline-text"></div>
                </div>
              </li>

              <!-- Th·ªùi gian -->
              <li class="timeline-item">
                <div class="timeline-dot"></div>
                <div class="timeline-content">
                  <div class="timeline-title">Th·ªùi gian:</div>
                  <div class="timeline-text">
                    <div id="detailCampaignTimeRange"></div>
                    <div id="detailCampaignDaysLeftText"></div>
                  </div>
                </div>
              </li>

              <!-- Kho l·∫•y h√†ng -->
              <li class="timeline-item">
                <div class="timeline-dot"></div>
                <div class="timeline-content">
                  <div class="timeline-title">Kho l·∫•y h√†ng:</div>
                  <div id="detailWarehouseAddress" class="timeline-text"></div>
                </div>
              </li>

              <!-- ƒê·ªãa ƒëi·ªÉm giao h√†ng -->
              <li class="timeline-item">
                <div class="timeline-dot"></div>
                <div class="timeline-content">
                  <div class="timeline-title">ƒê·ªãa ƒëi·ªÉm giao h√†ng:</div>
                  <div id="detailCampaignLocation" class="timeline-text"></div>
                </div>
              </li>
            </ul>

            <!-- Kh·ªëi info text th∆∞·ªùng -->
            <div class="campaign-meta">
              <div>
                <span>T·ªïng TNV c·∫ßn:</span>
                <span id="detailCampaignVolTarget">‚Äì</span>
              </div>
              <div>
                <span>T·ªïng TNV ƒë√£ ƒëƒÉng k√Ω:</span>
                <span id="detailCampaignVolJoined">‚Äì</span>
              </div>
              <div>
                <span>Created by:</span>
                <span id="detailCreatedByAdmin">‚Äì</span>
              </div>
            </div>
          </div>

          <!-- Tab: Danh s√°ch TNV -->
          <div id="tabVolunteers" class="timeline-tab-panel">
            <div class="vol-list-header">Danh s√°ch TNV ƒë√£ ƒëƒÉng k√Ω</div>
            <div id="volunteerList" class="vol-list">
              <!-- render b·∫±ng JS -->
            </div>
          </div>
        </div>

        <!-- MAP -->
        <div class="campaign-map-wrapper">
          <div class="map-toolbar">
            <button class="map-btn map-btn-active">Map</button>
          </div>
          <div id="campaignMap" class="map"></div>
        </div>
      </div>
    </section>
  </main>

  <!-- Leaflet JS -->
  <script
    src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
    integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
    crossorigin=""
  ></script>

  <script>
    // ====== DATA DEMO ======
    const campaigns = [
      {
        id: "CP_2025001",
        status: "InTransit",
        name: "Chi·∫øn d·ªãch M√°i ·∫•m Nh·∫≠t H·ªìng",
        description:
          "H·ªó tr·ª£ c√°c h·ªô gia ƒë√¨nh c√≥ tr·∫ª em kh√≥ khƒÉn t·∫°i khu v·ª±c Linh Trung.",
        timeRangeText: "0h00 15/12/2025 - 23h59 29/12/2025.",
        daysLeft: 7,
        warehouseAddress: "WH_0001 ‚Äì ƒë∆∞·ªùng Ho√†ng Di·ªáu, Linh Trung, Th·ªß ƒê·ª©c.",
        location: "Nh√† vƒÉn h√≥a Linh Trung, Th·ªß ƒê·ª©c.",
        volunteersTarget: 30,
        volunteersJoined: 18,
        createdByAdmin: "AD_918956342 (V√¢n)",
        image: "assets/nha-van-hoa-linh-trung.jpg",
        nodes: [
          {
            lat: 10.869,
            lng: 106.629,
            label: "Nh√† vƒÉn h√≥a Linh Trung"
          }
        ],
        volunteers: [
          {
            code: "VL_910050678",
            name: "Nguy·ªÖn VƒÉn An",
            phone: "09xx 111 222",
            status: "ƒê√£ x√°c nh·∫≠n"
          },
          {
            code: "VL_910012345",
            name: "Tr·∫ßn Mai H∆∞∆°ng",
            phone: "09xx 333 444",
            status: "ƒêang ch·ªù"
          }
        ]
      },
      {
        id: "CP_2025002",
        status: "Upcoming",
        name: "Chi·∫øn d·ªãch Trung thu y√™u th∆∞∆°ng",
        description:
          "T·ªï ch·ª©c ph√°t qu√† Trung thu cho tr·∫ª em khu nh√† tr·ªç t·∫°i Qu·∫≠n 4.",
        timeRangeText: "0h00 01/09/2025 - 23h59 10/09/2025.",
        daysLeft: 15,
        warehouseAddress: "WH_0002 ‚Äì ƒë∆∞·ªùng X, Ph∆∞·ªùng 8, Qu·∫≠n 4.",
        location: "Nh√† vƒÉn h√≥a Ph∆∞·ªùng 8, Qu·∫≠n 4.",
        volunteersTarget: 20,
        volunteersJoined: 5,
        createdByAdmin: "AD_918956342 (V√¢n)",
        image: "assets/nha-van-hoa-q4.jpg",
        nodes: [
          {
            lat: 10.759,
            lng: 106.706,
            label: "Nh√† vƒÉn h√≥a Ph∆∞·ªùng 8"
          },
          {
            lat: 10.757,
            lng: 106.713,
            label: "ƒêi·ªÉm t·∫≠p k·∫øt khu nh√† tr·ªç"
          }
        ],
        volunteers: [
          {
            code: "VL_920000001",
            name: "L√™ Minh Tu·∫•n",
            phone: "09xx 555 666",
            status: "ƒê√£ x√°c nh·∫≠n"
          },
          {
            code: "VL_920000002",
            name: "Ph·∫°m Th·∫£o Nhi",
            phone: "09xx 777 888",
            status: "ƒêang ch·ªù"
          }
        ]
      },
      {
        id: "CP_2025003",
        status: "Delivered",
        name: "Chi·∫øn d·ªãch Xu√¢n s·∫ª chia",
        description:
          "Trao t·∫∑ng qu√† T·∫øt cho c√°c h·ªô gia ƒë√¨nh kh√≥ khƒÉn t·∫°i khu v·ª±c An L·∫°c.",
        timeRangeText: "0h00 10/01/2025 - 23h59 25/01/2025.",
        daysLeft: 0,
        warehouseAddress: "WH_0003 ‚Äì ƒë∆∞·ªùng Y, An L·∫°c, B√¨nh T√¢n.",
        location: "Nh√† vƒÉn h√≥a An L·∫°c, B√¨nh T√¢n.",
        volunteersTarget: 40,
        volunteersJoined: 40,
        createdByAdmin: "AD_918956342 (V√¢n)",
        image: "assets/nha-van-hoa-bt.jpg",
        nodes: [
          {
            lat: 10.752,
            lng: 106.603,
            label: "Nh√† vƒÉn h√≥a An L·∫°c"
          }
        ],
        volunteers: [
          {
            code: "VL_930000001",
            name: "ƒê·ªó Qu·ªëc B·∫£o",
            phone: "09xx 999 000",
            status: "Ho√†n th√†nh"
          }
        ]
      }
    ];

    let currentStatusFilter = "ALL";
    let selectedCampaignId = null;

    let listEl, searchInput, chipButtons;
    let map, markerGroup;

    // Tab elements
    let detailTabBtn, volunteersTabBtn, tabDetailPanel, tabVolunteersPanel, volunteerListEl;

    // DOM getters cho panel detail
    const detailIdEl = () => document.getElementById("detailCampaignId");
    const detailStatusEl = () => document.getElementById("detailCampaignStatus");
    const detailNameEl = () => document.getElementById("detailCampaignName");
    const detailDescriptionEl = () =>
      document.getElementById("detailCampaignDescription");
    const detailTimeRangeEl = () =>
      document.getElementById("detailCampaignTimeRange");
    const detailDaysLeftTextEl = () =>
      document.getElementById("detailCampaignDaysLeftText");
    const detailWarehouseAddressEl = () =>
      document.getElementById("detailWarehouseAddress");
    const detailLocationEl = () =>
      document.getElementById("detailCampaignLocation");
    const detailVolTargetEl = () =>
      document.getElementById("detailCampaignVolTarget");
    const detailVolJoinedEl = () =>
      document.getElementById("detailCampaignVolJoined");
    const detailCreatedByAdminEl = () =>
      document.getElementById("detailCreatedByAdmin");

    function getStatusPillClass(status) {
      if (status === "InTransit") return "status-InTransit";
      if (status === "Delivered") return "status-Delivered";
      if (status === "Upcoming") return "status-Upcoming";
      return "";
    }

    function getStatusText(status) {
      if (status === "InTransit") return "ƒêang ch·∫°y";
      if (status === "Delivered") return "Ho√†n th√†nh";
      if (status === "Upcoming") return "S·∫Øp di·ªÖn ra";
      return status;
    }

    function formatDaysLeftText(daysLeft) {
      if (typeof daysLeft !== "number") return "";
      if (daysLeft > 0) return `C√≤n ${daysLeft} ng√†y c√≤n l·∫°i`;
      if (daysLeft === 0) return "ƒê√£ h·∫øt th·ªùi gian c√≤n l·∫°i";
      return "";
    }

    function getVolunteerPercent(c) {
      if (!c.volunteersTarget) return 0;
      return Math.min(100, (c.volunteersJoined / c.volunteersTarget) * 100);
    }

    function getFilteredCampaigns() {
      const term = (searchInput.value || "").toLowerCase().trim();
      return campaigns.filter((c) => {
        const matchStatus =
          currentStatusFilter === "ALL" || c.status === currentStatusFilter;

        const matchSearch =
          !term ||
          c.id.toLowerCase().includes(term) ||
          c.name.toLowerCase().includes(term);

        return matchStatus && matchSearch;
      });
    }

    // ====== RENDER LIST C·ªòT 2 ======
    function renderCampaignList() {
      const filtered = getFilteredCampaigns();

      if (!filtered.length) {
        listEl.innerHTML =
          '<div style="font-size:0.8rem;color:#6b7280;">Kh√¥ng c√≥ campaign ph√π h·ª£p.</div>';
        return;
      }

      listEl.innerHTML = filtered
        .map((c) => {
          const percent = getVolunteerPercent(c);
          const isActive = c.id === selectedCampaignId;
          const activeClass = isActive ? " active" : "";
          const statusClass = getStatusPillClass(c.status);
          const statusText = getStatusText(c.status);
          const daysText = formatDaysLeftText(c.daysLeft) || "";

          return `
            <div class="campaign-card${activeClass}" data-id="${c.id}">
              <div class="campaign-card-inner">
                ${
                  c.image
                    ? `
                    <div class="campaign-thumb-wrapper">
                      <img
                        src="${c.image}"
                        class="campaign-thumbnail"
                        alt="${c.location || "Nh√† vƒÉn h√≥a"}"
                      />
                    </div>
                    `
                    : `
                    <div class="campaign-thumb-wrapper">
                      <div class="campaign-thumbnail"></div>
                    </div>
                    `
                }
                <div class="campaign-info">
                  <div class="campaign-card-header">
                    <div class="campaign-id">#${c.id}</div>
                    <div class="status-pill ${statusClass}">${statusText}</div>
                  </div>
                  <div class="campaign-body">
                    <div class="campaign-name">${c.name}</div>
                    <div class="campaign-location">
                      ${daysText || " "}
                    </div>
                    <div class="campaign-progress">
                      <div class="campaign-progress-bar" style="width:${percent}%"></div>
                    </div>
                    <div class="campaign-volunteers">
                      ${c.volunteersJoined}/${c.volunteersTarget} TNV ƒë√£ tham gia
                    </div>
                  </div>
                </div>
              </div>
            </div>
          `;
        })
        .join("");
    }

    // ====== DETAIL C·ªòT 3 ======
    function renderCampaignDetail(campaign) {
      if (!campaign) return;

      // Header
      detailIdEl().textContent = campaign.id;
      const statusEl = detailStatusEl();
      statusEl.textContent = getStatusText(campaign.status);
      statusEl.className = `status-pill ${getStatusPillClass(campaign.status)}`;

      // N·ªôi dung timeline
      detailNameEl().textContent = campaign.name || "‚Äì";
      detailDescriptionEl().textContent = campaign.description || "‚Äì";
      detailTimeRangeEl().textContent = campaign.timeRangeText || "‚Äì";
      detailDaysLeftTextEl().textContent = formatDaysLeftText(campaign.daysLeft);

      detailWarehouseAddressEl().textContent =
        campaign.warehouseAddress || "‚Äì";
      detailLocationEl().textContent = campaign.location || "‚Äì";

      detailVolTargetEl().textContent =
        campaign.volunteersTarget ?? "‚Äì";
      detailVolJoinedEl().textContent =
        campaign.volunteersJoined ?? "‚Äì";

      detailCreatedByAdminEl().textContent =
        campaign.createdByAdmin || "‚Äì";

      renderVolunteerList(campaign);
      updateMapRoute(campaign);
    }

    function renderVolunteerList(campaign) {
      if (!volunteerListEl) return;
      const list = campaign.volunteers || [];
      if (!list.length) {
        volunteerListEl.innerHTML =
          '<div style="font-size:0.78rem;color:#6b7280;">Ch∆∞a c√≥ TNV ƒëƒÉng k√Ω.</div>';
        return;
      }
      volunteerListEl.innerHTML = list
        .map(
          (v) => `
        <div class="vol-card">
          <div class="vol-card-main">
            <div class="vol-code">${v.code}</div>
            <div class="vol-name">${v.name}</div>
          </div>
          <div class="vol-card-side">
            <div class="vol-pill">${v.status || "ƒêang ch·ªù"}</div>
          </div>
        </div>
      `
        )
        .join("");
    }

    function setActiveTab(tab) {
      if (!detailTabBtn || !volunteersTabBtn) return;
      if (tab === "detail") {
        detailTabBtn.classList.add("tab-active");
        volunteersTabBtn.classList.remove("tab-active");
        tabDetailPanel.classList.add("active");
        tabVolunteersPanel.classList.remove("active");
      } else {
        detailTabBtn.classList.remove("tab-active");
        volunteersTabBtn.classList.add("tab-active");
        tabDetailPanel.classList.remove("active");
        tabVolunteersPanel.classList.add("active");
      }
    }

    // ====== MAP ======
    function initMap() {
      map = L.map("campaignMap").setView([10.78, 106.7], 11);

      L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
        maxZoom: 19,
        attribution: "&copy; OpenStreetMap contributors"
      }).addTo(map);

      markerGroup = L.layerGroup().addTo(map);
    }

    // T·∫°o icon bubble "18/30 TNV"
    function createVolunteerIcon(ratioText) {
      return L.divIcon({
        className: "vol-marker-wrapper leaflet-div-icon",
        html: `<div class="vol-marker">${ratioText}</div>`,
        iconSize: [80, 28],
        iconAnchor: [40, 14],
        popupAnchor: [0, -16]
      });
    }

    // Map: hi·ªÉn th·ªã t·∫•t c·∫£ ƒëi·ªÉm c·ªßa c√°c campaign ƒëang di·ªÖn ra
    function updateMapRoute(selectedCampaign) {
      if (!map) return;

      markerGroup.clearLayers();

      const activeStatuses = ["InTransit", "Upcoming"];
      const allLatLngs = [];

      campaigns.forEach((camp) => {
        if (!activeStatuses.includes(camp.status)) return;
        if (!camp.nodes || !camp.nodes.length) return;

        const ratioText = `${camp.volunteersJoined}/${camp.volunteersTarget} TNV`;

        camp.nodes.forEach((node) => {
          const latlng = [node.lat, node.lng];
          allLatLngs.push(latlng);

          const marker = L.marker(latlng, {
            icon: createVolunteerIcon(ratioText)
          }).addTo(markerGroup);

          marker.bindPopup(
            `<strong>${node.label || camp.name}</strong><br>${ratioText}<br>${
              camp.location || ""
            }`
          );
        });
      });

      if (!allLatLngs.length) return;

      if (allLatLngs.length === 1) {
        map.setView(allLatLngs[0], 14);
      } else {
        map.fitBounds(allLatLngs, { padding: [20, 20] });
      }
    }

    // ====== EVENT HANDLERS ======
    function onCardClick(e) {
      const card = e.target.closest(".campaign-card");
      if (!card) return;

      const id = card.getAttribute("data-id");
      const campaign = campaigns.find((c) => c.id === id);
      if (!campaign) return;

      selectedCampaignId = id;
      renderCampaignList();
      renderCampaignDetail(campaign);
    }

    function onSearchChange() {
      renderCampaignList();
      const current = campaigns.find((c) => c.id === selectedCampaignId);
      if (current) renderCampaignDetail(current);
    }

    function onChipClick(e) {
      chipButtons.forEach((btn) => btn.classList.remove("chip-active"));
      e.target.classList.add("chip-active");

      currentStatusFilter = e.target.getAttribute("data-status") || "ALL";
      renderCampaignList();

      const filtered = getFilteredCampaigns();
      if (!filtered.length) return;

      if (!filtered.some((c) => c.id === selectedCampaignId)) {
        selectedCampaignId = filtered[0].id;
        renderCampaignList();
        renderCampaignDetail(filtered[0]);
      }
    }

    // ====== INIT ======
    function initCampaignPage() {
      listEl = document.getElementById("campaignList");
      searchInput = document.getElementById("campaignSearch");
      chipButtons = document.querySelectorAll(".chips-row .chip");

      detailTabBtn = document.querySelector(
        '.timeline-tabs .tab[data-tab="detail"]'
      );
      volunteersTabBtn = document.querySelector(
        '.timeline-tabs .tab[data-tab="volunteers"]'
      );
      tabDetailPanel = document.getElementById("tabDetail");
      tabVolunteersPanel = document.getElementById("tabVolunteers");
      volunteerListEl = document.getElementById("volunteerList");

      const btnAdd = document.getElementById("btnAddCampaign");
      if (btnAdd) {
        btnAdd.addEventListener("click", () => {
          alert("Demo only ‚Äì t√≠nh nƒÉng th√™m campaign s·∫Ω ƒë∆∞·ª£c tri·ªÉn khai sau.");
        });
      }

      if (listEl) listEl.addEventListener("click", onCardClick);
      if (searchInput) searchInput.addEventListener("input", onSearchChange);
      chipButtons.forEach((btn) => btn.addEventListener("click", onChipClick));

      if (detailTabBtn && volunteersTabBtn) {
        detailTabBtn.addEventListener("click", () => setActiveTab("detail"));
        volunteersTabBtn.addEventListener("click", () =>
          setActiveTab("volunteers")
        );
      }

      initMap();

      if (campaigns.length > 0) {
        selectedCampaignId = campaigns[0].id;
        renderCampaignList();
        renderCampaignDetail(campaigns[0]);
      }
    }

    if (document.readyState === "loading") {
      document.addEventListener("DOMContentLoaded", initCampaignPage);
    } else {
      initCampaignPage();
    }

    // ƒêi·ªÅu h∆∞·ªõng chung ‚Äì fallback
    function goTo(path) {
      window.location.href = path;
    }
  </script>
</body>
</html>
