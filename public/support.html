<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <title>S·ª± c·ªë & h·ªó tr·ª£ ‚Äì Foodbank Logistics Hub</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <style>
    /* ========= Reset & base ========= */
    *, *::before, *::after {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
        sans-serif;
      color: #111827;
      background: #f5f6fb;
    }

    .app {
      display: flex;
      min-height: 100vh;
    }

    /* ========= Main sidebar ========= */

    .sidebar-main {
      width: 220px;
      background: #050816;
      color: #f9fafb;
      padding: 16px 16px 20px;
      display: flex;
      flex-direction: column;
      gap: 16px;
    }

    .sidebar-main-header {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .logo-circle {
      width: 34px;
      height: 34px;
      border-radius: 12px;
      background: linear-gradient(135deg, #facc15, #f97316);
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      color: #111827;
    }

    .logo-title {
      font-weight: 700;
      font-size: 1rem;
    }

    .logo-sub {
      font-size: 0.75rem;
      opacity: 0.7;
    }

    .sidebar-main-nav {
      display: flex;
      flex-direction: column;
      gap: 4px;
      margin-top: 10px;
      flex: 1;
    }

    .nav-item {
      border: none;
      outline: none;
      background: transparent;
      color: #e5e7eb;
      padding: 8px 10px;
      border-radius: 999px;
      text-align: left;
      font-size: 0.85rem;
      cursor: pointer;
      transition: background 0.15s, transform 0.08s;
    }

    .nav-item:hover {
      background: rgba(148, 163, 184, 0.35);
      transform: translateY(-1px);
    }

    .nav-item-active {
      background: #facc15;
      color: #111827;
    }

    .sidebar-main-user {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 10px 8px;
      border-radius: 12px;
      background: #020617;
    }

    .avatar-circle {
      width: 30px;
      height: 30px;
      border-radius: 999px;
      background: #0f172a;
      border: 2px solid #facc15;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.75rem;
    }

    .user-name {
      font-size: 0.85rem;
      font-weight: 600;
    }

    .user-role {
      font-size: 0.75rem;
      opacity: 0.7;
    }

    /* ========= Support layout ========= */

    .support-layout {
      flex: 1;
      display: grid;
      grid-template-columns: 260px minmax(0, 1fr);
      height: 100vh;
    }

    /* --- Left: Support sidebar --- */

    .support-sidebar {
      background: #fdfdfd;
      border-right: 1px solid #e5e7eb;
      display: flex;
      flex-direction: column;
    }

    .support-sidebar-header {
      padding: 18px 20px 10px;
      border-bottom: 1px solid #e5e7eb;
    }

    .support-sidebar-header h1 {
      margin: 0;
      font-size: 1.05rem;
    }

    .support-sidebar-header p {
      margin: 3px 0 0;
      font-size: 0.8rem;
      color: #6b7280;
    }

    .support-sidebar-menu {
      padding: 10px 14px 8px;
      border-bottom: 1px solid #e5e7eb;
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .support-menu-item {
      border-radius: 12px;
      border: 1px solid transparent;
      padding: 8px 10px;
      font-size: 0.85rem;
      cursor: pointer;
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: transparent;
      color: #374151;
    }

    .support-menu-item span:first-child {
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .support-menu-item-badge {
      font-size: 0.78rem;
      padding: 2px 7px;
      border-radius: 999px;
      background: #e5e7eb;
      color: #111827;
    }

    .support-menu-item-active {
      background: #111827;
      color: #f9fafb;
    }

    .support-menu-item-active .support-menu-item-badge {
      background: #facc15;
      color: #111827;
    }

    .support-sidebar-filters {
      padding: 10px 14px 6px;
    }

    .input {
      width: 100%;
      border-radius: 999px;
      border: 1px solid #e5e7eb;
      padding: 7px 11px;
      font-size: 0.85rem;
      background-color: #ffffff;
    }

    .search-input {
      padding-left: 30px;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16'%3E%3Ccircle cx='7' cy='7' r='4.5' stroke='%239ca3af' stroke-width='1.4' fill='none'/%3E%3Cpath d='M10 10l3 3' stroke='%239ca3af' stroke-width='1.4' stroke-linecap='round'/%3E%3C/svg%3E");
      background-repeat: no-repeat;
      background-position: 9px center;
      background-size: 16px;
    }

    .chips-row {
      margin-top: 8px;
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
    }

    .chip {
      border-radius: 999px;
      border: 1px solid #e5e7eb;
      padding: 3px 10px;
      font-size: 0.75rem;
      background: #ffffff;
      cursor: pointer;
    }

    .chip-active {
      background: #facc15;
      border-color: #facc15;
    }

    .support-sidebar-stats {
      padding: 6px 14px 10px;
      border-top: 2px dashed #e5e7eb;
      font-size: 0.78rem;
      color: #4b5563;
    }

    .support-sidebar-stats-row {
      display: flex;
      justify-content: space-between;
      margin-top: 2px;
    }

    /* --- Right: list + detail --- */

    .support-main {
      display: flex;
      flex-direction: column;
      height: 100vh;
    }

    .support-main-header {
      padding: 16px 22px 12px;
      border-bottom: 1px solid #e5e7eb;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .support-main-title {
      font-size: 1.05rem;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .support-main-sub {
      font-size: 0.78rem;
      color: #6b7280;
    }

    .btn {
      border-radius: 999px;
      border: 1px solid transparent;
      padding: 7px 13px;
      font-size: 0.8rem;
      cursor: pointer;
    }

    .btn-primary {
      background: #111827;
      color: #f9fafb;
    }

    .btn-primary:hover {
      opacity: 0.9;
    }

    .support-main-body {
      flex: 1;
      display: grid;
      grid-template-columns: minmax(0, 380px) minmax(0, 1fr);
      padding: 14px 22px 20px;
      gap: 16px;
    }

    /* Ticket list */

    .ticket-list {
      background: #ffffff;
      border-radius: 18px;
      box-shadow: 0 1px 3px rgba(15, 23, 42, 0.08);
      padding: 10px 10px 12px;
      display: flex;
      flex-direction: column;
      height: 100%;
    }

    .ticket-list-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 3px;
      margin-bottom: 3px;
    }

    .ticket-list-header h3 {
      margin: 5px;
      font-size: 0.9rem;
    }

    .ticket-counter {
      font-size: 0.78rem;
      color: #6b7280;
    }

    .ticket-list-scroll {
      margin-top: 8px;
      overflow-y: auto;
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .ticket-card {
      border-radius: 14px;
      border: 1px solid #e5e7eb;
      padding: 8px 9px;
      font-size: 0.78rem;
      cursor: pointer;
      background: #ffffff;
      display: flex;
      flex-direction: column;
      gap: 4px;
      transition: box-shadow 0.15s, transform 0.08s, border-color 0.15s,
        background 0.15s;
    }

    .ticket-card:hover {
      box-shadow: 0 3px 8px rgba(15, 23, 42, 0.12);
      transform: translateY(-1px);
    }

    .ticket-card.active {
      border-color: #facc15;
      background: #fffbeb;
    }

    .ticket-card-top {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .ticket-id {
      font-weight: 600;
      font-size: 0.8rem;
    }

    .ticket-status-pill {
      padding: 2px 8px;
      border-radius: 999px;
      font-size: 0.7rem;
      font-weight: 600;
      white-space: nowrap;
    }

    .status-open {
      background: #fee2e2;
      color: #b91c1c;
    }

    .status-inprogress {
      background: #dbeafe;
      color: #1d4ed8;
    }

    .status-resolved {
      background: #dcfce7;
      color: #15803d;
    }

    .ticket-card-main {
      color: #4b5563;
    }

    .ticket-title {
      font-weight: 500;
      margin-bottom: 2px;
    }

    .ticket-meta {
      font-size: 0.74rem;
      color: #6b7280;
    }

    .ticket-last-contact {
      margin-top: 2px;
      color: #9ca3af;
      font-size: 0.74rem;
    }

    .ticket-footer {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 0.74rem;
      color: #9ca3af;
    }

    /* severity pill */
    .ticket-severity {
      padding: 1px 6px;
      border-radius: 999px;
      font-size: 0.7rem;
      font-weight: 600;
    }

    .severity-low {
      background: #e0f2fe;
      color: #0369a1;
    }

    .severity-medium {
      background: #fef3c7;
      color: #92400e;
    }

    .severity-high {
      background: #fee2e2;
      color: #b91c1c;
    }

    /* Ticket detail */

    .ticket-detail {
      background: #ffffff;
      border-radius: 18px;
      box-shadow: 0 1px 3px rgba(15, 23, 42, 0.08);
      padding: 12px 16px 14px;
      display: flex;
      flex-direction: column;
      height: 100%;
      font-size: 0.82rem;
    }

    .ticket-detail-header {
      display: flex;
      justify-content: space-between;
      gap: 12px;
      margin-top: 5px;
      margin-bottom: 8px;
      align-items: flex-start; /* cƒÉn tr√™n */
    }

    .ticket-detail-header-right {
      margin-left: auto;
      display: flex;
      flex-direction: column;
      align-items: flex-end;
      gap: 4px;
    }

    .ticket-detail-title {
      font-size: 0.95rem;
      font-weight: 600;
    }

    .ticket-detail-sub {
      font-size: 0.76rem;
      color: #6b7280;
    }

    .ticket-detail-tags {
      display: flex;
      flex-wrap: wrap;
      gap: 4px;
      margin: 6px 0 8px;
    }

    .tag-pill {
      padding: 2px 8px;
      border-radius: 999px;
      background: #f3f4f6;
      font-size: 0.72rem;
      color: #4b5563;
    }

    .ticket-section-title {
      font-weight: 600;
      margin-top: 8px;
      margin-bottom: 2px;
    }

    .ticket-section-body {
      color: #4b5563;
      font-size: 0.82rem;
      white-space: pre-line;
    }

    .ticket-detail-grid {
      margin-top: 8px;
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 4px 16px;
      font-size: 0.78rem;
    }

    .ticket-detail-grid div span:first-child {
      color: #6b7280;
    }

    /* L·ªãch s·ª≠ trao ƒë·ªïi d·∫°ng chat */
    .ticket-conversation {
      margin-top: 10px;
      border-top: 1px dashed #e5e7eb;
      padding-top: 8px;
      font-size: 0.78rem;
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .conversation-message {
      display: flex;
      align-items: flex-start;
    }

    .conversation-bubble {
      max-width: 100%;
      padding: 6px 10px;
      border-radius: 12px;
      background: #f3f4f6;
      color: #374151;
      line-height: 1.3;
    }

    .placeholder {
      margin: auto;
      text-align: center;
      color: #9ca3af;
      font-size: 0.85rem;
    }

    @media (max-width: 1100px) {
      .support-layout {
        grid-template-columns: 1fr;
      }
      .sidebar-main {
        display: none;
      }
    }

    @media (max-width: 900px) {
      .support-main-body {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body class="app">
  <!-- SIDEBAR CH√çNH -->
  <aside class="sidebar-main">
    <div class="sidebar-main-header">
      <div class="logo-circle">FB</div>
      <div>
        <div class="logo-title">Foodbank</div>
        <div class="logo-sub">Logistics Hub</div>
      </div>
    </div>

    <nav class="sidebar-main-nav">
      <button class="nav-item" onclick="goTo('orders.html')">ƒê∆°n h√†ng</button>
      <button class="nav-item" onclick="goTo('trip.html')">Trip / Tuy·∫øn ƒë∆∞·ªùng</button>
      <button class="nav-item" onclick="goTo('campaign.html')">Campaign</button>
      <button class="nav-item" onclick="goTo('volunteers.html')">T√¨nh nguy·ªán vi√™n</button>
      <button class="nav-item" onclick="goTo('community.html')">T·ªï d√¢n ph·ªë</button>
      <button class="nav-item" onclick="goTo('warehouse.html')">Kho t·∫≠p k·∫øt</button>
      <button class="nav-item" onclick="goTo('area.html')">Area</button>
      <button class="nav-item nav-item-active" onclick="goTo('support.html')">S·ª± c·ªë & h·ªó tr·ª£</button>
    </nav>

    <div class="sidebar-main-user">
      <div class="avatar-circle">AD</div>
      <div>
        <div class="user-name">Admin ‚Äì V√¢n</div>
        <div class="user-role">ƒêi·ªÅu ph·ªëi trung t√¢m</div>
      </div>
    </div>
  </aside>

  <!-- LAYOUT S·ª∞ C·ªê & H·ªñ TR·ª¢ -->
  <main class="support-layout">
    <!-- Sidebar nh·ªè b√™n tr√°i -->
    <section class="support-sidebar">
      <div class="support-sidebar-header">
        <h1>S·ª± c·ªë & h·ªó tr·ª£</h1>
        <p>Qu·∫£n l√Ω incident v√† ph·∫£n h·ªìi t·ª´ TNV</p>
      </div>

      <div class="support-sidebar-menu">
        <button class="support-menu-item support-menu-item-active" data-type="incident">
          <span>‚ö†Ô∏è Incident</span>
          <span class="support-menu-item-badge" id="incidentCountBadge">0</span>
        </button>
        <button class="support-menu-item" data-type="feedback">
          <span>üí¨ Feedback</span>
          <span class="support-menu-item-badge" id="feedbackCountBadge">0</span>
        </button>
      </div>

      <div class="support-sidebar-filters">
        <input
          id="ticketSearch"
          class="input search-input"
          placeholder="T√¨m ID, TNV, campaign‚Ä¶"
        />
        <div class="chips-row">
          <button class="chip chip-active" data-status="ALL">All</button>
          <button class="chip" data-status="Open">Open</button>
          <button class="chip" data-status="InProgress">In progress</button>
          <button class="chip" data-status="Resolved">Resolved</button>
        </div>
      </div>

      <div class="support-sidebar-stats">
        <div>Today overview</div>
        <div class="support-sidebar-stats-row">
          <span>Incident open</span>
          <span id="sidebarIncidentOpen">‚Äì</span>
        </div>
        <div class="support-sidebar-stats-row">
          <span>Feedback m·ªõi</span>
          <span id="sidebarFeedbackNew">‚Äì</span>
        </div>
      </div>
    </section>

    <!-- Main: danh s√°ch + chi ti·∫øt -->
    <section class="support-main">
      <header class="support-main-header">
        <div>
          <div class="support-main-title">
            <span id="mainTitle">Incident</span>
            <span class="support-main-sub" id="mainSubtitle">
              Ticket t·ª´ c√°c chi·∫øn d·ªãch & chuy·∫øn ƒëi
            </span>
          </div>
        </div>
        <div>
          <button class="btn btn-primary">+ T·∫°o ticket m·ªõi</button>
        </div>
      </header>

      <div class="support-main-body">
        <!-- Danh s√°ch ticket -->
        <div class="ticket-list">
          <div class="ticket-list-header">
            <h3 id="listHeaderTitle">Incident ƒëang theo d√µi</h3>
            <span class="ticket-counter" id="listCounter">0 item</span>
          </div>
          <div id="ticketList" class="ticket-list-scroll"></div>
        </div>

        <!-- Chi ti·∫øt ticket -->
        <div class="ticket-detail" id="ticketDetail">
          <div class="placeholder">
            Ch·ªçn m·ªôt incident ho·∫∑c feedback ·ªü danh s√°ch b√™n tr√°i ƒë·ªÉ xem chi ti·∫øt.
          </div>
        </div>
      </div>
    </section>
  </main>

<script>
  // Demo data
  const incidents = [
    {
      id: "INC_0001",
      status: "Open",
      severity: 2,
      source: "App",
      campaignId: "CP_2025001",
      campaignName: "Chi·∫øn d·ªãch M√°i ·∫•m Nh·∫≠t H·ªìng",
      volunteerCode: "VL_910050678",
      volunteerName: "Nguy·ªÖn VƒÉn An",
      handlerCode: "AD_918956342",
      handlerName: "M·ªπ V√¢n",
      createdAt: "15.08.2025 09:15",
      title: "TNV b√°o kh√°ch h√†ng ch∆∞a nh·∫≠n ƒë∆∞·ª£c qu√†",
      shortMeta: "Trip #25ACDB12 ‚Äì Linh Trung, Th·ªß ƒê·ª©c",
      description:
        "TNV b√°o ƒë√£ giao t·ªõi nh√† nh∆∞ng ng∆∞·ªùi nh·∫≠n ƒëi l√†m, ch∆∞a c√≥ ai nh·∫≠n gi√∫p. C·∫ßn g·ªçi l·∫°i x√°c nh·∫≠n khung gi·ªù giao ph√π h·ª£p ho·∫∑c g·ª≠i t·∫°i nh√† vƒÉn h√≥a.",
      channel: "In-app incident",
      tags: ["Delivery", "Linh Trung"],
      timeline: [
        "09:15 ‚Äì TNV Nguy·ªÖn VƒÉn An: Kh√°ch ch∆∞a nh·∫≠n ƒë∆∞·ª£c qu√†, nh√† ch·ªâ c√≥ ng∆∞·ªùi gi√†.",
        "09:18 ‚Äì ƒêi·ªÅu ph·ªëi vi√™n V√¢n: ƒê√£ g·ªçi cho TNV, ƒë·ªÅ xu·∫•t giao l·∫°i bu·ªïi t·ªëi.",
      ],
    },
    {
      id: "INC_0002",
      status: "InProgress",
      severity: 3,
      source: "Hotline",
      campaignId: "CP_2025002",
      campaignName: "Chi·∫øn d·ªãch Trung thu y√™u th∆∞∆°ng",
      volunteerCode: "VL_920000001",
      volunteerName: "L√™ Minh Tu·∫•n",
      handlerCode: "AD_000000002",
      handlerName: "VƒÉn Kh√°nh",
      createdAt: "16.08.2025 18:40",
      title: "Thi·∫øu 5 ph·∫ßn qu√† t·∫°i ƒëi·ªÉm t·∫≠p k·∫øt",
      shortMeta: "Kho WH_0002 ‚Äì Qu·∫≠n 4",
      description:
        "Khi TNV nh·∫≠n h√†ng t·∫°i kho, s·ªë l∆∞·ª£ng th·ª±c t·∫ø thi·∫øu 5 ph·∫ßn so v·ªõi danh s√°ch. C·∫ßn r√† so√°t t·ªìn kho v√† c·∫≠p nh·∫≠t l·∫°i s·ªë l∆∞·ª£ng ph√¢n b·ªï.",
      channel: "Hotline",
      tags: ["Warehouse", "S·ªë l∆∞·ª£ng"],
      timeline: [
        "18:40 ‚Äì Hotline: TNV b√°o thi·∫øu 5 ph·∫ßn qu√† khi nh·∫≠n t·∫°i WH_0002.",
        "18:45 ‚Äì Kho: ƒêang ki·ªÉm k√™ l·∫°i t·ªìn kho, s·∫Ω ph·∫£n h·ªìi trong 15 ph√∫t.",
      ],
    },
    {
      id: "INC_0003",
      status: "Resolved",
      severity: 1,
      source: "App",
      campaignId: "CP_2025003",
      campaignName: "Chi·∫øn d·ªãch Xu√¢n s·∫ª chia",
      volunteerCode: "VL_930000001",
      volunteerName: "ƒê·ªó Qu·ªëc B·∫£o",
      handlerCode: "AD_918956342",
      handlerName: "M·ªπ V√¢n",
      createdAt: "02.02.2025 14:05",
      title: "ƒê∆∞·ªùng v√†o h·∫ªm b·ªã ng·∫≠p, ph·∫£i ƒë·ªïi l·ªô tr√¨nh",
      shortMeta: "An L·∫°c, B√¨nh T√¢n",
      description:
        "ƒê∆∞·ªùng h·∫ªm ch√≠nh b·ªã ng·∫≠p do m∆∞a l·ªõn, TNV ƒë·ªÅ xu·∫•t ƒë·ªïi l·ªô tr√¨nh giao, chia th√†nh 2 ƒë·ª£t trong ng√†y. ƒê√£ c·∫≠p nh·∫≠t xong.",
      channel: "In-app incident",
      tags: ["Traffic", "Weather"],
      timeline: [
        "14:05 ‚Äì TNV: H·∫ªm ch√≠nh ng·∫≠p s√¢u, xe kh√¥ng v√†o ƒë∆∞·ª£c.",
        "14:20 ‚Äì ƒêi·ªÅu ph·ªëi: ƒê√£ chia route th√†nh 2 chuy·∫øn, ∆∞u ti√™n c√°c h·ªô c√≥ ng∆∞·ªùi gi√†.",
        "17:30 ‚Äì TNV: ƒê√£ giao xong t·∫•t c·∫£ ƒë∆°n.",
      ],
    },
  ];

  const feedbacks = [
    {
      id: "FB_0001",
      status: "Open",
      severity: 1,
      rating: 4, // 1‚Äì5 sao
      source: "Form",
      campaignId: "CP_2025001",
      campaignName: "Chi·∫øn d·ªãch M√°i ·∫•m Nh·∫≠t H·ªìng",
      volunteerCode: "VL_910012345",
      volunteerName: "Tr·∫ßn Mai H∆∞∆°ng",
      handlerCode: "AD_918956342",
      handlerName: "M·ªπ V√¢n",
      createdAt: "17.08.2025 20:10",
      title: "ƒê·ªÅ xu·∫•t tƒÉng th·ªùi gian ngh·ªâ gi·ªØa c√°c ca",
      shortMeta: "Ca chi·ªÅu ‚Äì Linh Trung",
      description:
        "TNV ƒë·ªÅ xu·∫•t tƒÉng th√™m 10‚Äì15 ph√∫t ngh·ªâ gi·ªØa c√°c ca v√¨ th·ªùi ti·∫øt n·∫Øng n√≥ng, ƒë·∫∑c bi·ªát cho c√°c TNV l·ªõn tu·ªïi.",
      channel: "Feedback form",
      tags: ["Suggestion", "Operation"],
      timeline: [
        "20:10 ‚Äì TNV: ƒê·ªÅ xu·∫•t tƒÉng th√™m th·ªùi gian ngh·ªâ gi·ªØa c√°c ca v√¨ th·ªùi ti·∫øt kh√° n√≥ng.",
      ],
    },
    {
      id: "FB_0002",
      status: "Resolved",
      severity: 2,
      rating: 3,
      source: "Survey",
      campaignId: "CP_2025003",
      campaignName: "Chi·∫øn d·ªãch Xu√¢n s·∫ª chia",
      volunteerCode: "VL_930000001",
      volunteerName: "ƒê·ªó Qu·ªëc B·∫£o",
      handlerCode: "AD_000000002",
      handlerName: "Foodbank Operation Team",
      createdAt: "28.01.2025 09:00",
      title: "App ph√¢n c√¥ng tuy·∫øn h∆°i xa so v·ªõi nh√† TNV",
      shortMeta: "B√¨nh T√¢n",
      description:
        "TNV g√≥p √Ω c√≥ th·ªÉ ∆∞u ti√™n ph√¢n tuy·∫øn g·∫ßn nh√† TNV h∆°n ƒë·ªÉ ti·∫øt ki·ªám th·ªùi gian di chuy·ªÉn r·ªóng.",
      channel: "Post-campaign survey",
      tags: ["Routing", "UX"],
      timeline: [
        "09:00 ‚Äì TNV: Tuy·∫øn ƒë∆∞·ª£c ph√¢n c√¥ng h∆°i xa nh√†, mong ∆∞u ti√™n g·∫ßn h∆°n.",
        "09:15 ‚Äì Operation: ƒê√£ ghi nh·∫≠n, ƒë∆∞a v√†o backlog t·ªëi ∆∞u thu·∫≠t to√°n gh√©p ƒë∆°n.",
      ],
    },
    // Feedback t·ª´ H·ªô y·∫øu th·∫ø
    {
      id: "FB_0003",
      status: "Open",
      severity: 2,
      rating: 5,
      source: "Hotline",
      campaignId: "CP_2025004",
      campaignName: "Chi·∫øn d·ªãch ƒê·ªìng h√†nh c√πng b√© ƒë·∫øn tr∆∞·ªùng",
      volunteerCode: "HH_000000045",        // d√πng chung field cho code ng∆∞·ªùi g·ª≠i
      volunteerName: "B√† L√™ Th·ªã Hoa",        // d√πng chung field cho t√™n ng∆∞·ªùi g·ª≠i
      senderType: "H·ªô y·∫øu th·∫ø",             // th√¥ng tin th√™m, hi·ªán ch∆∞a render
      handlerCode: "AD_918956342",
      handlerName: "M·ªπ V√¢n",
      createdAt: "05.02.2025 19:30",
      title: "G√≥p √Ω th·ªùi gian giao qu√† bu·ªïi t·ªëi mu·ªôn",
      shortMeta: "Nh√† tr·ªç khu Long Th·∫°nh M·ªπ",
      description:
        "H·ªô gia ƒë√¨nh ph·∫£n h·ªìi r·∫±ng th·ªùi gian giao qu√† t·ªëi sau 21h kh√° mu·ªôn v·ªõi tr·∫ª nh·ªè, mong ch∆∞∆°ng tr√¨nh c√≥ th·ªÉ ∆∞u ti√™n giao s·ªõm h∆°n v√†o cu·ªëi tu·∫ßn.",
      channel: "Hotline",
      tags: ["Schedule", "Household"],
      timeline: [
        "19:30 ‚Äì H·ªô y·∫øu th·∫ø: Qu√† giao sau 21h kh√° mu·ªôn, mong giao s·ªõm h∆°n cho tr·∫ª nh·ªè.",
      ],
    },
  ];

  let currentType = "incident"; // incident | feedback
  let currentStatusFilter = "ALL";
  let selectedId = null;

  // DOM
  let listEl, detailEl, searchInput, statusChips, typeButtons;
  let incidentBadge, feedbackBadge, sidebarIncidentOpen, sidebarFeedbackNew;
  let listHeaderTitle, listCounter, mainTitle, mainSubtitle;

  function getStatusClass(status) {
    if (status === "Open") return "status-open";
    if (status === "InProgress") return "status-inprogress";
    if (status === "Resolved") return "status-resolved";
    return "";
  }

  function getSeverityClass(level) {
    if (level === 3) return "severity-high";
    if (level === 2) return "severity-medium";
    return "severity-low";
  }

  function getSeverityLabel(level) {
    if (level === 3) return "Cao";
    if (level === 2) return "Trung b√¨nh";
    return "Th·∫•p";
  }

  function getChannelIcon(ticket) {
    // Hotline => üìû, c√≤n l·∫°i üí¨
    if (
      (ticket.source && ticket.source.toLowerCase().includes("hotline")) ||
      (ticket.channel && ticket.channel.toLowerCase().includes("hotline"))
    ) {
      return "üìû";
    }
    return "üí¨";
  }

  function getDataForCurrentType() {
    return currentType === "incident" ? incidents : feedbacks;
  }

  function filterTickets() {
    const data = getDataForCurrentType();
    const q = (searchInput.value || "").toLowerCase().trim();

    return data.filter((t) => {
      const matchStatus =
        currentStatusFilter === "ALL" ||
        t.status.toLowerCase() === currentStatusFilter.toLowerCase();

      const fullText = [
        t.id || "",
        t.title || "",
        t.campaignId || "",
        t.campaignName || "",
        t.volunteerCode || "",
        t.volunteerName || "",
        t.handlerName || "",
        t.handlerCode || "",
        t.senderType || "",
      ]
        .join(" ")
        .toLowerCase();

      const matchSearch = !q || fullText.includes(q);
      return matchStatus && matchSearch;
    });
  }

  function renderList() {
    const tickets = filterTickets();
    if (!tickets.length) {
      listEl.innerHTML =
        '<div style="font-size:0.8rem;color:#6b7280;padding:8px;">Kh√¥ng c√≥ ticket ph√π h·ª£p.</div>';
      listCounter.textContent = "0 item";
      return;
    }

    listEl.innerHTML = tickets
      .map((t) => {
        const statusCls = getStatusClass(t.status);
        const severityCls = getSeverityClass(t.severity);
        const activeCls = t.id === selectedId ? " active" : "";
        const lastLine =
          t.timeline && t.timeline.length ? t.timeline[t.timeline.length - 1] : "";
        const icon = getChannelIcon(t);
        const handler = t.handlerName ? `X·ª≠ l√Ω: ${t.handlerName}` : "X·ª≠ l√Ω: Ch∆∞a g√°n";

        const isIncident = currentType === "incident";
        const campaignLine = isIncident
          ? `${t.campaignId} ‚Äì ${t.campaignName}`
          : "";
        const actorLabel = isIncident ? "TNV" : "Ng∆∞·ªùi g·ª≠i";
        const actorLine = `${actorLabel}: ${t.volunteerName} (${t.volunteerCode})`;

        return `
          <div class="ticket-card${activeCls}" data-id="${t.id}">
            <div class="ticket-card-top">
              <div class="ticket-id">#${t.id}</div>
              <div class="ticket-status-pill ${statusCls}">${t.status}</div>
            </div>
            <div class="ticket-card-main">
              <div class="ticket-title">${t.title}</div>
              <div class="ticket-meta">
                ${campaignLine ? campaignLine + "<br/>" : ""}
                ${actorLine}<br/>
                ${handler}
              </div>
              ${
                lastLine
                  ? `<div class="ticket-last-contact">Last contact: ${icon} ${lastLine}</div>`
                  : ""
              }
            </div>
            <div class="ticket-footer">
              <span>${t.createdAt}</span>
              <span class="ticket-severity ${severityCls}">M·ª©c ƒë·ªô ${t.severity}</span>
            </div>
          </div>
        `;
      })
      .join("");

    listCounter.textContent =
      tickets.length + (tickets.length > 1 ? " items" : " item");
  }

  function starString(rating) {
    if (!rating || rating <= 0) return "‚òÜ‚òÜ‚òÜ‚òÜ‚òÜ";
    if (rating >= 5) return "‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ";
    return "‚òÖ".repeat(rating) + "‚òÜ".repeat(5 - rating);
  }

  function renderDetail() {
    const data = getDataForCurrentType();
    const ticket = data.find((t) => t.id === selectedId);
    if (!ticket) {
      detailEl.innerHTML =
        '<div class="placeholder">Ch·ªçn m·ªôt incident ho·∫∑c feedback ·ªü danh s√°ch b√™n tr√°i ƒë·ªÉ xem chi ti·∫øt.</div>';
      return;
    }

    const statusCls = getStatusClass(ticket.status);
    const severityCls = getSeverityClass(ticket.severity);
    const typeLabel = currentType === "incident" ? "Incident" : "Feedback";

    // Tags: Incident gi·ªØ campaign, Feedback b·ªè campaign
    let tagsHtml = "";
    if (currentType === "incident") {
      tagsHtml = `
        <span class="tag-pill">${ticket.campaignId} ‚Äì ${ticket.campaignName}</span>
        <span class="tag-pill">TNV: ${ticket.volunteerName}</span>
        <span class="tag-pill">${ticket.channel}</span>
        ${(ticket.tags || [])
          .map((tag) => `<span class="tag-pill">#${tag}</span>`)
          .join("")}
      `;
    } else {
      tagsHtml = `
        <span class="tag-pill">Ng∆∞·ªùi g·ª≠i: ${ticket.volunteerName}</span>
        <span class="tag-pill">${ticket.channel}</span>
        ${(ticket.tags || [])
          .map((tag) => `<span class="tag-pill">#${tag}</span>`)
          .join("")}
      `;
    }

    // Grid th√¥ng tin
    let gridHtml;
    if (currentType === "feedback") {
      const ratingText = ticket.rating
        ? `${ticket.rating}/5 ${starString(ticket.rating)}`
        : "Ch∆∞a ƒë√°nh gi√°";
      gridHtml = `
        <div><span>Rate:</span> <strong>${ratingText}</strong></div>
        <div><span>Ngu·ªìn:</span> <strong>${ticket.source}</strong></div>
        <div><span>M√£ ng∆∞·ªùi g·ª≠i:</span> <strong>${ticket.volunteerCode}</strong></div>
        <div><span>T√™n ng∆∞·ªùi g·ª≠i:</span> <strong>${ticket.volunteerName}</strong></div>
        <div><span>M√£ Admin:</span> <strong>${ticket.handlerCode || "‚Äî"}</strong></div>
        <div><span>Ng∆∞·ªùi x·ª≠ l√Ω:</span> <strong>${ticket.handlerName || "Ch∆∞a g√°n"}</strong></div>
      `;
    } else {
      gridHtml = `
        <div><span>Campaign ID:</span> <strong>${ticket.campaignId}</strong></div>
        <div><span>Ngu·ªìn:</span> <strong>${ticket.source}</strong></div>
        <div><span>M√£ TNV:</span> <strong>${ticket.volunteerCode}</strong></div>
        <div><span>Ng∆∞·ªùi t·∫°o:</span> <strong>${ticket.volunteerName}</strong></div>
        <div><span>M√£ Admin:</span> <strong>${ticket.handlerCode || "‚Äî"}</strong></div>
        <div><span>Ng∆∞·ªùi x·ª≠ l√Ω:</span> <strong>${ticket.handlerName || "Ch∆∞a g√°n"}</strong></div>
      `;
    }

    detailEl.innerHTML = `
      <div class="ticket-detail-header">
        <div>
          <div class="ticket-detail-title">${ticket.title}</div>
          <div class="ticket-detail-sub">
            ${typeLabel} ‚Ä¢ #${ticket.id} ‚Ä¢ ${ticket.createdAt}
          </div>
        </div>
        <div class="ticket-detail-header-right">
          <div class="ticket-status-pill ${statusCls}">${ticket.status}</div>
          <div class="ticket-severity ${severityCls}">
            M·ª©c ƒë·ªô ${ticket.severity}
          </div>
        </div>
      </div>

      <div class="ticket-detail-tags">
        ${tagsHtml}
      </div>

      <div class="ticket-section">
        <div class="ticket-section-title">M√¥ t·∫£ chi ti·∫øt</div>
        <div class="ticket-section-body">${ticket.description}</div>
      </div>

      <div class="ticket-detail-grid">
        ${gridHtml}
      </div>

      <div class="ticket-conversation">
        <div class="ticket-section-title">L·ªãch s·ª≠ trao ƒë·ªïi</div>
        ${
          ticket.timeline && ticket.timeline.length
            ? ticket.timeline
                .map(
                  (line) => `
            <div class="conversation-message">
              <div class="conversation-bubble">${line}</div>
            </div>
          `
                )
                .join("")
            : '<div style="font-size:0.78rem;color:#6b7280;">Ch∆∞a c√≥ trao ƒë·ªïi n√†o ƒë∆∞·ª£c ghi nh·∫≠n.</div>'
        }
      </div>
    `;
  }

  function updateSidebarStats() {
    const openInc = incidents.filter((i) => i.status === "Open").length;
    const newFb = feedbacks.filter((f) => f.status === "Open").length;

    sidebarIncidentOpen.textContent = openInc;
    sidebarFeedbackNew.textContent = newFb;

    incidentBadge.textContent = incidents.length;
    feedbackBadge.textContent = feedbacks.length;
  }

  function updateMainHeader() {
    if (currentType === "incident") {
      mainTitle.textContent = "Incident";
      mainSubtitle.textContent =
        " C√°c s·ª± c·ªë ph√°t sinh trong qu√° tr√¨nh giao h√†ng & t·ªï ch·ª©c chi·∫øn d·ªãch";
      listHeaderTitle.textContent = "Incident ƒëang theo d√µi";
    } else {
      mainTitle.textContent = "Feedback";
      mainSubtitle.textContent =
        " Ghi nh·∫≠n ph·∫£n h·ªìi & ƒë·ªÅ xu·∫•t c·∫£i thi·ªán tr·∫£i nghi·ªám c·ªßa TNV, t·ªï d√¢n ph·ªë, h·ªô y·∫øu th·∫ø";
      listHeaderTitle.textContent = "Feedback t·ª´ user";
    }
  }

  // Events
  function onTicketClick(e) {
    const card = e.target.closest(".ticket-card");
    if (!card) return;
    selectedId = card.getAttribute("data-id");
    renderList();
    renderDetail();
  }

  function onTypeClick(e) {
    const btn = e.currentTarget;
    const type = btn.getAttribute("data-type");
    if (!type || type === currentType) return;

    currentType = type;
    selectedId = null;

    typeButtons.forEach((b) =>
      b.classList.remove("support-menu-item-active")
    );
    btn.classList.add("support-menu-item-active");

    updateMainHeader();
    renderList();
    renderDetail();
  }

  function onStatusChipClick(e) {
    statusChips.forEach((c) => c.classList.remove("chip-active"));
    e.target.classList.add("chip-active");
    currentStatusFilter = e.target.getAttribute("data-status") || "ALL";
    renderList();
    renderDetail();
  }

  function onSearchChange() {
    renderList();
    renderDetail();
  }

  function initSupportPage() {
    listEl = document.getElementById("ticketList");
    detailEl = document.getElementById("ticketDetail");
    searchInput = document.getElementById("ticketSearch");
    statusChips = document.querySelectorAll(".chips-row .chip");
    typeButtons = document.querySelectorAll(".support-menu-item");

    incidentBadge = document.getElementById("incidentCountBadge");
    feedbackBadge = document.getElementById("feedbackCountBadge");
    sidebarIncidentOpen = document.getElementById("sidebarIncidentOpen");
    sidebarFeedbackNew = document.getElementById("sidebarFeedbackNew");

    listHeaderTitle = document.getElementById("listHeaderTitle");
    listCounter = document.getElementById("listCounter");
    mainTitle = document.getElementById("mainTitle");
    mainSubtitle = document.getElementById("mainSubtitle");

    // Events
    listEl.addEventListener("click", onTicketClick);
    typeButtons.forEach((b) => b.addEventListener("click", onTypeClick));
    statusChips.forEach((c) => c.addEventListener("click", onStatusChipClick));
    searchInput.addEventListener("input", onSearchChange);

    updateSidebarStats();
    updateMainHeader();
    renderList();
  }

  if (document.readyState === "loading") {
    document.addEventListener("DOMContentLoaded", initSupportPage);
  } else {
    initSupportPage();
  }

  // ƒêi·ªÅu h∆∞·ªõng chung
  function goTo(path) {
    window.location.href = path;
  }
</script>

</body>
</html>
